import{d as j,h as J,g as m,x as K,c as d,b as e,k as z,H as I,e as f,J as u,K as v,Z as y,l as w,m as $,t as r,$ as R,a0 as q,o as p,A as D,a1 as G,_ as O}from"./index-vHkR6Xec.js";const Q={class:"top"},W={for:"user_id",title:"用户ID"},X={for:"username",title:"用户名"},Y={for:"email",title:"用户邮箱"},ee={for:"nickname",title:"用户昵称"},le={for:"status",title:"用户状态"},te={for:"role",title:"用户角色"},ae={class:"list"},se={class:"table-wrapper"},oe={class:"avatar-cell"},ne=["src"],ie={class:"username-cell"},ue={class:"nickname-cell"},re={class:"email-cell"},de={class:"brief-cell"},ve={class:"brief-content"},pe={class:"time-cell"},me=["onClick"],ge=["onClick"],ce={class:"pagination-wrapper"},fe={class:"pagination-info"},be={key:0,class:"pagination"},ke=["disabled"],ye={key:0,class:"pagination-ellipsis"},Ce=["onClick"],he=["disabled"],we={class:"confirm-header"},Se={class:"confirm-body"},Ue={class:"confirm-actions"},xe={class:"modal-body"},Ve={class:"edit-form"},_e={class:"form-row"},ze={class:"form-group"},Ie={class:"form-group"},De={class:"form-row"},Me={class:"form-group"},Ne={class:"form-group"},$e={class:"form-row"},Fe={class:"form-group"},Be={class:"form-group full-width"},Ee={class:"form-group full-width"},Pe={class:"form-group full-width"},Te={class:"modal-actions"},Ae=["disabled"],He=j({__name:"User",setup(Le){const g=J(),M={userId:"",username:"",email:"",nickname:"",status:"",role:""},s=m({...M}),N=m([]),n=m({page:1,pageSize:10,total:0}),F=()=>{s.value={...M},n.value.page=1,c()},c=async()=>{const a={page:n.value.page,pageSize:n.value.pageSize};s.value.userId&&(a.userId=Number(s.value.userId)),s.value.username&&(a.username=s.value.username),s.value.email&&(a.email=s.value.email),s.value.nickname&&(a.nickname=s.value.nickname),s.value.status&&(a.status=Number(s.value.status)),s.value.role&&(a.role=Number(s.value.role));try{const l=await R(a);N.value=l.data.data||[],n.value={page:l.data.page||1,pageSize:l.data.pageSize||10,total:l.data.total||0}}catch(l){console.error("获取用户失败:",l),g.show("获取用户失败","error",3e3)}},S=a=>{n.value.page=a,c()},B=a=>{n.value.pageSize=a,n.value.page=1,c()},U=K(()=>Math.ceil(n.value.total/n.value.pageSize)),C=m(null),x=m(!1),i=m({}),b=m({saving:!1}),E=()=>{const a=n.value.page,l=U.value,t=[];if(l<=7)for(let o=1;o<=l;o++)t.push(o);else if(t.push(1),a<=4){for(let o=2;o<=5;o++)t.push(o);t.push("..."),t.push(l)}else if(a>=l-3){t.push("...");for(let o=l-4;o<=l;o++)o>1&&t.push(o)}else{t.push("...");for(let o=a-1;o<=a+1;o++)t.push(o);t.push("..."),t.push(l)}return t},V=m(!1),k=m({title:"",message:"",onConfirm:()=>{},onCancel:()=>{}}),P=(a,l,t,o)=>{k.value={title:a,message:l,onConfirm:t,onCancel:()=>{}},V.value=!0},_=()=>{V.value=!1},T=async a=>{P("确认删除","确定要删除这个用户吗？此操作不可恢复！",async()=>{const l=g.show("正在删除用户...","loading");try{await G(a),g.update(l,{text:"用户删除成功！",type:"success",duration:2e3}),c(),_()}catch(t){console.error("删除用户失败:",t),g.update(l,{text:"删除失败，请稍后重试",type:"error",duration:3e3})}})},A=a=>{switch(String(a)){case"0":return"未激活";case"1":return"正常";case"2":return"封禁";default:return"未知"}},H=a=>{switch(String(a)){case"0":return"普通用户";case"1":return"管理员";default:return"未知"}},L=a=>{C.value={...a},i.value={username:a.username,email:a.email,nickname:a.nickname,brief:a.brief,status:Number(a.status),role:Number(a.role),avatar:a.avatar,header_background:a.header_background},x.value=!0},h=()=>{x.value=!1,C.value=null,i.value={},b.value.saving=!1},Z=async()=>{if(!C.value)return;b.value.saving=!0;const a=g.show("正在保存用户信息...","loading");try{await q(C.value.id,i.value),g.update(a,{text:"用户信息更新成功！",type:"success",duration:2e3}),h(),c()}catch(l){console.error("更新用户信息失败:",l),g.update(a,{text:"更新失败，请稍后重试",type:"error",duration:3e3})}finally{b.value.saving=!1}};return c(),(a,l)=>(p(),d(w,null,[e("div",Q,[e("form",{onSubmit:I(c,["prevent"])},[e("label",W,[l[21]||(l[21]=f("用户ID： ")),u(e("input",{type:"number",id:"user_id",placeholder:"用户ID","onUpdate:modelValue":l[0]||(l[0]=t=>s.value.userId=t)},null,512),[[v,s.value.userId]])]),e("label",X,[l[22]||(l[22]=f("用户名： ")),u(e("input",{type:"text",id:"username",placeholder:"用户名(支持模糊查询)","onUpdate:modelValue":l[1]||(l[1]=t=>s.value.username=t)},null,512),[[v,s.value.username]])]),e("label",Y,[l[23]||(l[23]=f("用户邮箱： ")),u(e("input",{type:"text",id:"email",placeholder:"用户邮箱(支持模糊查询)","onUpdate:modelValue":l[2]||(l[2]=t=>s.value.email=t)},null,512),[[v,s.value.email]])]),e("label",ee,[l[24]||(l[24]=f("用户昵称： ")),u(e("input",{type:"text",id:"nickname",placeholder:"用户昵称(支持模糊查询)","onUpdate:modelValue":l[3]||(l[3]=t=>s.value.nickname=t)},null,512),[[v,s.value.nickname]])]),e("label",le,[l[26]||(l[26]=f("用户状态： ")),u(e("select",{id:"status","onUpdate:modelValue":l[4]||(l[4]=t=>s.value.status=t)},l[25]||(l[25]=[e("option",{value:""},"全部状态",-1),e("option",{value:"0"},"未激活",-1),e("option",{value:"1"},"正常",-1),e("option",{value:"2"},"封禁",-1)]),512),[[y,s.value.status]])]),e("label",te,[l[28]||(l[28]=f("用户角色： ")),u(e("select",{id:"role","onUpdate:modelValue":l[5]||(l[5]=t=>s.value.role=t)},l[27]||(l[27]=[e("option",{value:""},"全部角色",-1),e("option",{value:"0"},"普通用户",-1),e("option",{value:"1"},"管理员",-1)]),512),[[y,s.value.role]])]),l[29]||(l[29]=e("button",{type:"submit"},"查询",-1)),e("button",{type:"button",onClick:F},"重置")],32)]),e("div",ae,[e("div",se,[e("table",null,[l[30]||(l[30]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"用户头像"),e("th",null,"用户名"),e("th",null,"昵称"),e("th",null,"邮箱"),e("th",null,"简介"),e("th",null,"角色"),e("th",null,"状态"),e("th",null,"注册时间"),e("th",null,"操作")])],-1)),e("tbody",null,[(p(!0),d(w,null,$(N.value,t=>(p(),d("tr",{key:t.id},[e("td",null,r(t.id),1),e("td",null,[e("div",oe,[e("img",{src:t.avatar||"/default-avatar.png",alt:"头像"},null,8,ne)])]),e("td",ie,r(t.username),1),e("td",ue,r(t.nickname||"-"),1),e("td",re,r(t.email),1),e("td",de,[e("div",ve,r(t.brief||"-"),1)]),e("td",null,[e("span",{class:D(["role-badge","role-"+t.role])},r(H(t.role)),3)]),e("td",null,[e("span",{class:D(["status-badge","status-"+t.status])},r(A(t.status)),3)]),e("td",pe,r(new Date(t.created_at).toLocaleDateString()),1),e("td",null,[e("button",{onClick:o=>L(t),class:"edit-btn"},"编辑",8,me),e("button",{onClick:o=>T(t.id),class:"delete-btn"},"删除",8,ge)])]))),128))])])])]),e("div",ce,[e("div",fe,[e("span",null,"共 "+r(n.value.total)+" 条记录",1),u(e("select",{"onUpdate:modelValue":l[6]||(l[6]=t=>n.value.pageSize=t),onChange:l[7]||(l[7]=t=>B(n.value.pageSize)),class:"page-size-select"},l[31]||(l[31]=[e("option",{value:"5"},"5条/页",-1),e("option",{value:"10"},"10条/页",-1),e("option",{value:"20"},"20条/页",-1),e("option",{value:"50"},"50条/页",-1)]),544),[[y,n.value.pageSize]])]),U.value>1?(p(),d("div",be,[e("button",{disabled:n.value.page<=1,onClick:l[8]||(l[8]=t=>S(n.value.page-1)),class:"pagination-btn"}," 上一页 ",8,ke),(p(!0),d(w,null,$(E(),(t,o)=>(p(),d(w,{key:o},[t==="..."?(p(),d("span",ye,"...")):(p(),d("button",{key:1,class:D(["pagination-btn",{active:t===n.value.page}]),onClick:Ze=>S(t)},r(t),11,Ce))],64))),128)),e("button",{disabled:n.value.page>=U.value,onClick:l[9]||(l[9]=t=>S(n.value.page+1)),class:"pagination-btn"}," 下一页 ",8,he)])):z("",!0)]),V.value?(p(),d("div",{key:0,class:"confirm-overlay",onClick:_},[e("div",{class:"confirm-dialog",onClick:l[11]||(l[11]=I(()=>{},["stop"]))},[e("div",we,[e("h3",null,r(k.value.title),1)]),e("div",Se,[l[32]||(l[32]=e("div",{class:"confirm-icon"},[e("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 9V14M12 17.5H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"#f59e0b","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e("p",null,r(k.value.message),1)]),e("div",Ue,[e("button",{type:"button",onClick:_,class:"confirm-cancel-btn"},"取消"),e("button",{type:"button",onClick:l[10]||(l[10]=(...t)=>k.value.onConfirm&&k.value.onConfirm(...t)),class:"confirm-ok-btn"},"确定")])])])):z("",!0),x.value?(p(),d("div",{key:1,class:"modal-overlay",onClick:h},[e("div",{class:"modal-container",onClick:l[20]||(l[20]=I(()=>{},["stop"]))},[e("div",{class:"modal-header"},[l[33]||(l[33]=e("h3",null,"编辑用户信息",-1)),e("button",{onClick:h,class:"modal-close"},"×")]),e("div",xe,[e("div",Ve,[e("div",_e,[e("div",ze,[l[34]||(l[34]=e("label",null,"用户名",-1)),u(e("input",{type:"text","onUpdate:modelValue":l[12]||(l[12]=t=>i.value.username=t),placeholder:"用户名"},null,512),[[v,i.value.username]])]),e("div",Ie,[l[35]||(l[35]=e("label",null,"邮箱",-1)),u(e("input",{type:"email","onUpdate:modelValue":l[13]||(l[13]=t=>i.value.email=t),placeholder:"邮箱地址"},null,512),[[v,i.value.email]])])]),e("div",De,[e("div",Me,[l[36]||(l[36]=e("label",null,"昵称",-1)),u(e("input",{type:"text","onUpdate:modelValue":l[14]||(l[14]=t=>i.value.nickname=t),placeholder:"用户昵称"},null,512),[[v,i.value.nickname]])]),e("div",Ne,[l[38]||(l[38]=e("label",null,"状态",-1)),u(e("select",{"onUpdate:modelValue":l[15]||(l[15]=t=>i.value.status=t)},l[37]||(l[37]=[e("option",{value:0},"未激活",-1),e("option",{value:1},"正常",-1),e("option",{value:2},"封禁",-1)]),512),[[y,i.value.status]])])]),e("div",$e,[e("div",Fe,[l[40]||(l[40]=e("label",null,"角色",-1)),u(e("select",{"onUpdate:modelValue":l[16]||(l[16]=t=>i.value.role=t)},l[39]||(l[39]=[e("option",{value:0},"普通用户",-1),e("option",{value:1},"管理员",-1)]),512),[[y,i.value.role]])])]),e("div",Be,[l[41]||(l[41]=e("label",null,"个人简介",-1)),u(e("textarea",{"onUpdate:modelValue":l[17]||(l[17]=t=>i.value.brief=t),placeholder:"个人简介",rows:"3"},null,512),[[v,i.value.brief]])]),e("div",Ee,[l[42]||(l[42]=e("label",null,"头像链接",-1)),u(e("input",{type:"url","onUpdate:modelValue":l[18]||(l[18]=t=>i.value.avatar=t),placeholder:"头像图片链接"},null,512),[[v,i.value.avatar]])]),e("div",Pe,[l[43]||(l[43]=e("label",null,"背景图片链接",-1)),u(e("input",{type:"url","onUpdate:modelValue":l[19]||(l[19]=t=>i.value.header_background=t),placeholder:"背景图片链接"},null,512),[[v,i.value.header_background]])])])]),e("div",Te,[e("button",{onClick:h,class:"modal-cancel-btn"},"取消"),e("button",{onClick:Z,disabled:b.value.saving,class:"modal-save-btn"},r(b.value.saving?"保存中...":"保存"),9,Ae)])])])):z("",!0)],64))}}),Je=O(He,[["__scopeId","data-v-35584725"]]);export{Je as default};
