import{d as V,c as w,b as o,o as u,C as q,h as j,q as J,g,O as W,x as O,a as p,n,_ as E,u as K,v as P,p as G,w as k,I as U,J as b,z as H,k as M,K as I,A as R}from"./index-vHkR6Xec.js";import{M as Q,T as X,A as Y,g as Z}from"./Media-COzH9Z4j.js";import{e as ee}from"./articles-cyklCtDv.js";import{C as te}from"./ChevronLeft-BvftFjUr.js";const le={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},se=V({name:"ExchangeAlt",render:function(v,t){return u(),w("svg",le,t[0]||(t[0]=[o("path",{d:"M0 168v-16c0-13.255 10.745-24 24-24h360V80c0-21.367 25.899-32.042 40.971-16.971l80 80c9.372 9.373 9.372 24.569 0 33.941l-80 80C409.956 271.982 384 261.456 384 240v-48H24c-13.255 0-24-10.745-24-24zm488 152H128v-48c0-21.314-25.862-32.08-40.971-16.971l-80 80c-9.372 9.373-9.372 24.569 0 33.941l80 80C102.057 463.997 128 453.437 128 432v-48h360c13.255 0 24-10.745 24-24v-16c0-13.255-10.745-24-24-24z",fill:"currentColor"},null,-1)]))}}),oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 384 512"},ae=V({name:"FileWord",render:function(v,t){return u(),w("svg",oe,t[0]||(t[0]=[o("path",{d:"M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm57.1 120H305c7.7 0 13.4 7.1 11.7 14.7l-38 168c-1.2 5.5-6.1 9.3-11.7 9.3h-38c-5.5 0-10.3-3.8-11.6-9.1c-25.8-103.5-20.8-81.2-25.6-110.5h-.5c-1.1 14.3-2.4 17.4-25.6 110.5c-1.3 5.3-6.1 9.1-11.6 9.1H117c-5.6 0-10.5-3.9-11.7-9.4l-37.8-168c-1.7-7.5 4-14.6 11.7-14.6h24.5c5.7 0 10.7 4 11.8 9.7c15.6 78 20.1 109.5 21 122.2c1.6-10.2 7.3-32.7 29.4-122.7c1.3-5.4 6.1-9.1 11.7-9.1h29.1c5.6 0 10.4 3.8 11.7 9.2c24 100.4 28.8 124 29.6 129.4c-.2-11.2-2.6-17.8 21.6-129.2c1-5.6 5.9-9.5 11.5-9.5zM384 121.9v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z",fill:"currentColor"},null,-1)]))}}),ne={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ie=V({name:"Image",render:function(v,t){return u(),w("svg",ne,t[0]||(t[0]=[o("path",{d:"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56s56-25.072 56-56s-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z",fill:"currentColor"},null,-1)]))}}),re={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 384 512"},ue=V({name:"MapMarkerAlt",render:function(v,t){return u(),w("svg",re,t[0]||(t[0]=[o("path",{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192C0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67c-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80s-80 35.817-80 80s35.817 80 80 80z",fill:"currentColor"},null,-1)]))}}),ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 576 512"},de=V({name:"Video",render:function(v,t){return u(),w("svg",ce,t[0]||(t[0]=[o("path",{d:"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z",fill:"currentColor"},null,-1)]))}});function pe(_,v,t){console.log("@uploadUrl:",v);const e={url:`${v}`,method:"post",data:_,timeout:120*1e3,headers:{},onUploadProgress:t};return q(e)}const fe={class:"upload-container"},ve=["disabled"],me=V({__name:"Upload",setup(_,{expose:v}){const t=j(),e=J(),a=g([]),m=g(!1),y=g(0),h=g([]),C=g(""),z=g(null),S=g(),$=g();e.configs.upload_method==="0"?$.value="/upload":e.configs.upload_method==="1"?$.value="/upload/s3":$.value="/upload";const D=i=>{const d=i.target;if(!d.files)return;const A=new Set(a.value.map(f=>`${f.file.name}_${f.file.size}`)),r=Array.from(d.files),x=[];for(const f of r){const N=`${f.name}_${f.size}`;if(A.has(N)){t.show(`已经选择过该文件${f.name}`,"info",2e3);continue}x.push({file:f,previewUrl:URL.createObjectURL(f)}),A.add(N)}const F=[...a.value,...x];if(F.length>Number(e.configs.upload_number))return t.show(`最多只能选择 ${e.configs.upload_number} 个文件`,"error",4e3);if(F.find(f=>!f.file.type.startsWith("image/")&&!f.file.type.startsWith("video/")))return a.value=[],t.show("只能上传图片/视频","error",4e3);if(F.find(f=>f.file.size/1024/1024>Number(e.configs.upload_size)))return a.value=[],t.show(`文件大小不能超过 ${e.configs.upload_size} M`,"error",4e3);a.value=F,t.show("文件选择成功","success",2e3),h.value=[],C.value="",y.value=0},B=async i=>{if(a.value.length===0){t.show("请先选择文件！","info",2e3);return}m.value=!0,y.value=0,C.value="",h.value=[];const d=new FormData;a.value.forEach(r=>{d.append("files",r.file)}),d.append("articleId",i);const A=r=>{r.total&&(y.value=Math.round(r.loaded*100/r.total))};try{S.value=t.show("开始上传文件...","loading");const r=await pe(d,$.value,A);t.update(S.value,{type:"success",text:"上传成功",duration:2e3}),h.value=r.data.paths}catch(r){console.error("上传失败:",r),r.response?C.value=r.response.data.message||"发生未知服务端错误":C.value=r.message||"网络请求失败"}finally{m.value=!1,a.value=[],z.value&&(z.value.value="")}};W(C,i=>{i&&t.update(S.value,{type:"error",text:i,duration:4e3})});const L=O(()=>a.value.filter(i=>i.file.type.startsWith("image/")).map((i,d)=>({id:String(d),image_url:i.previewUrl}))),T=O(()=>a.value.filter(i=>i.file.type.startsWith("video/")).map((i,d)=>({id:String(d),video_url:i.previewUrl,thumbnail_url:""})));function c(i){const d=i.map(x=>x.image_url),A=a.value.filter(x=>x.file.type.startsWith("image/")),r=a.value.filter(x=>x.file.type.startsWith("video/"));A.sort((x,F)=>d.indexOf(x.previewUrl)-d.indexOf(F.previewUrl)),a.value=[...A,...r]}function l(){m.value?t.show("请等待文件上传完成再操作","info",2e3):z.value?.click()}function s(i){a.value.splice(i,1)}return v({performUpload:B}),(i,d)=>(u(),w("div",fe,[p(Q,{"article-images":L.value,"article-videos":T.value,upload:!0,"upload-number":n(e).configs.upload_number,"onRemove:image":s,"onUpdate:articleImages":c,"onAdd:file":l},null,8,["article-images","article-videos","upload-number"]),o("input",{type:"file",multiple:"",onChange:D,ref_key:"fileInputRef",ref:z,disabled:m.value,class:"file-input",accept:"image/*,video/*"},null,40,ve)]))}}),he=E(me,[["__scopeId","data-v-e3468195"]]),ge={class:"container"},we={class:"header"},ye={id:"back"},xe={class:"body"},_e={class:"location"},ke={class:"func"},Ue={class:"media-input"},Ce=V({__name:"Post",setup(_){const v=K(),t=j(),e=P({content:"",status:1,location:"",type:0,isTop:!1,isAd:!1,adTitle:"",adUrl:"",imageUrls:[],videoUrls:[],thumbnail_url:""}),a=g(""),m=g(""),y=P({location:!1,add:!1}),h=g(!1);function C(){e.type===0?t.show("纯文字内容无需切换","info",2e3):(h.value=!h.value,h.value?t.show("已切换为外链","success",2e3):t.show("已切换为上传文件","success",2e3))}W(a,c=>{const l=c.split(/[\s,]+|[\n]+/).map(s=>s.trim()).filter(s=>s);e.imageUrls=l}),W(m,c=>{const l=c.split(/[\s,]+|[\n]+/).map(s=>s.trim()).filter(s=>s);e.videoUrls=l});function z(){if(e.isTop){e.isTop=!e.isTop,t.show("取消文章置顶","success",2e3);return}e.isTop=!e.isTop,t.show("文章置顶","success",2e3)}function S(){if(e.isAd){e.isAd=!e.isAd,t.show("取消文章为广告","success",2e3);return}e.isAd=!e.isAd,t.show("文章设置为广告","success",2e3)}function $(){e.type=(e.type+1)%3,e.type===0?(a.value="",m.value="",t.show("已切换为文本类型","success",2e3)):e.type===1?(a.value="",m.value="",t.show("已切换为图片类型","success",2e3)):(a.value="",m.value="",t.show("已切换为视频类型","success",2e3))}async function D(){if(y.location){t.show("请勿重复点击","info",2e3);return}const c=t.show("正在获取位置信息","loading");try{y.location=!0;const l=await Z();e.location=l?.result.subdivisions+" "+(l?.result.city?l?.result.city:""),t.update(c,{type:"success",text:"获取位置信息成功",duration:2e3})}catch(l){console.log(l),t.update(c,{type:"error",text:"获取位置信息失败",duration:2e3})}finally{y.location=!1}}const B=g();async function L(){if(!e.content&&(!e.imageUrls?.length||e.imageUrls.length===0)&&(!e.videoUrls?.length||e.videoUrls.length===0)){t.show("文章内容不能为空","info",2e3);return}if(y.add){t.show("请勿重复点击","info",2e3);return}const c=t.show("正在发表文章","loading");try{y.add=!0;const l=await ee(e);await B.value?.performUpload(l.data.id),e.content="",e.location="",e.imageUrls=[],e.videoUrls=[],e.thumbnail_url="",e.adTitle="",e.adUrl="",a.value="",m.value="",t.update(c,{type:"success",text:"发表成功",duration:2e3})}catch(l){console.log("发表文章失败",l),t.update(c,{type:"error",text:"发表失败",duration:2e3})}finally{y.add=!1}}const T=c=>{const l=c.target;l.style.height="auto",l.style.height=l.scrollHeight+"px"};return(c,l)=>(u(),w("div",ge,[o("div",we,[o("div",{class:"header-left",onClick:l[0]||(l[0]=s=>n(G).back())},[o("div",ye,[p(n(U),null,{default:k(()=>[p(n(te))]),_:1})]),l[10]||(l[10]=o("div",null,"发表文章",-1))]),o("div",{class:"header-right"},[o("button",{onClick:L},"发表")])]),o("div",xe,[b(o("textarea",{"onUpdate:modelValue":l[1]||(l[1]=s=>e.content=s),placeholder:"这一刻的想法...",onInput:T,class:"contentArea"},null,544),[[I,e.content]]),e.type!==0&&!h.value?(u(),H(he,{key:0,ref_key:"uploadRef",ref:B},null,512)):M("",!0),o("div",_e,[o("div",null,[p(n(U),{onClick:D,title:"点击获取位置信息"},{default:k(()=>[p(n(ue))]),_:1}),b(o("input",{type:"text",placeholder:"输入位置信息（可为空）","onUpdate:modelValue":l[2]||(l[2]=s=>e.location=s),style:{"background-color":"inherit"}},null,512),[[I,e.location]])])]),o("div",ke,[o("span",{class:R(["func-item",{true:e.isTop}]),onClick:l[3]||(l[3]=s=>Number(n(v).profile?.role)===1?z():n(t).show("权限不足","info",2e3)),title:"文章置顶"},[p(n(U),null,{default:k(()=>[p(n(X))]),_:1})],2),o("span",{class:R(["func-item",{true:e.isAd}]),onClick:l[4]||(l[4]=s=>Number(n(v).profile?.role)===1?S():n(t).show("权限不足","info",2e3)),title:"文章推广"},[p(n(U),null,{default:k(()=>[p(n(Y))]),_:1})],2),o("span",{class:"func-item true",onClick:$,title:"文章类型"},[e.type===0?(u(),H(n(U),{key:0},{default:k(()=>[p(n(ae))]),_:1})):e.type===1?(u(),H(n(U),{key:1},{default:k(()=>[p(n(ie))]),_:1})):e.type===2?(u(),H(n(U),{key:2},{default:k(()=>[p(n(de))]),_:1})):M("",!0)]),o("span",{class:R(["func-item",{true:h.value}]),onClick:C,title:"上传类型"},[p(n(U),null,{default:k(()=>[p(n(se))]),_:1})],2)]),o("div",Ue,[e.isAd?b((u(),w("input",{key:0,type:"text","onUpdate:modelValue":l[5]||(l[5]=s=>e.adTitle=s),placeholder:"输入广告标题，如：瞬刻",class:"textArea"},null,512)),[[I,e.adTitle]]):M("",!0),e.isAd?b((u(),w("input",{key:1,type:"text","onUpdate:modelValue":l[6]||(l[6]=s=>e.adUrl=s),placeholder:"输入广告链接，如：https://example.com",class:"textArea"},null,512)),[[I,e.adUrl]]):M("",!0),e.type===1&&h.value?b((u(),w("textarea",{key:2,"onUpdate:modelValue":l[7]||(l[7]=s=>a.value=s),placeholder:" 输入图片链接(使用“,”、空格、换行 区分图片)",onInput:T,class:"mediaArea"},null,544)),[[I,a.value]]):M("",!0),e.type===2&&h.value?b((u(),w("input",{key:3,"onUpdate:modelValue":l[8]||(l[8]=s=>m.value=s),placeholder:" 输入视频链接",onInput:T,class:"textArea"},null,544)),[[I,m.value]]):M("",!0),e.type===2&&h.value?b((u(),w("input",{key:4,"onUpdate:modelValue":l[9]||(l[9]=s=>e.thumbnail_url=s),placeholder:" 输入视频封面链接",onInput:T,class:"textArea"},null,544)),[[I,e.thumbnail_url]]):M("",!0)])])]))}}),$e=E(Ce,[["__scopeId","data-v-9174858a"]]);export{$e as default};
