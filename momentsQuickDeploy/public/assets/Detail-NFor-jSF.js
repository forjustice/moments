import{f as S,g as c,v as b,u as $,h as I,d as B,s as N,i as D,c as w,b as m,n as u,p as M,a as C,w as V,I as z,k as L,z as R,o as g,_ as E}from"./index-vHkR6Xec.js";import{A as F}from"./ArticleItem-CNpZcfUV.js";import{g as h,a as G,b as O,l as x,d as _}from"./articles-cyklCtDv.js";import{g as U,c as j}from"./comments-BwFQ22WX.js";import{C as q}from"./ChevronLeft-BvftFjUr.js";import"./time-Pdvgg59k.js";import"./Media-COzH9Z4j.js";const A=$(),r=I(),H=S("article",()=>{const s=c(null),a=c([]),d=c([]),o=b({article:!1,comment:!1,liker:!1}),p=async e=>{o.article=!0;try{const t=A.token?void 0:h(),i=await G(e,t);s.value=i.data}catch(t){console.error("获取文章内容失败：",t),s.value=null}finally{o.article=!1}},l=async e=>{o.liker=!0;try{const t=await O(e);d.value=t.data}catch(t){console.error(`获取文章 ${e} 的点赞用户列表失败`,t)}finally{o.liker=!1}};return{article:s,comments:a,likers:d,states:o,fetchArticle:p,fetchLikers:l,fetchComments:async e=>{o.comment=!0;try{const t=await U(e,{page:1,pageSize:999});return a.value=t.data.data,!0}catch(t){return console.error("获取评论失败",t),a.value=[],!1}finally{o.comment=!1}},createComment:async e=>{const t=r.show("正在发表评论","loading");try{const i=await j(e);if(i.data){const n=i.data;a.value.push(n),s.value&&s.value.comment_count++}return r.update(t,{type:"success",text:"发表成功",duration:2e3}),!0}catch(i){return console.error("发表评论失败",i),r.update(t,{type:"error",text:"发表失败",duration:2e3}),!1}},toggleLike:async e=>{if(!s.value)return;const t=s.value.isLiked,i=s.value.like_count;t?(s.value.isLiked=!1,s.value.like_count--):(s.value.isLiked=!0,s.value.like_count++);const n=c(1);try{if(A.token)s.value.isLiked?(n.value=r.show("正在点赞","loading"),await x(e),r.update(n.value,{text:"点赞成功",type:"success",duration:2e3})):(n.value=r.show("正在取消点赞","loading"),await _(e),r.update(n.value,{text:"取消点赞成功",type:"success",duration:2e3}));else{const v=h();s.value.isLiked?(n.value=r.show("正在点赞","loading"),await x(e,v),r.update(n.value,{text:"点赞成功",type:"success",duration:2e3})):(n.value=r.show("正在取消点赞","loading"),await _(e,v),r.update(n.value,{text:"取消点赞成功",type:"success",duration:2e3}))}return!0}catch(v){return console.error(`为文章${e}更新点赞状态失败`,v),s.value.isLiked=t,s.value.like_count=i,r.update(n.value,{text:"操作失败",type:"error",duration:2e3}),!1}finally{l(e)}}}}),J={class:"container"},K={class:"header"},P={class:"body"},Q={key:0},T=B({__name:"Detail",setup(s){const a=H(),d=N(),o=Number(d.params.articleId),p=c(!0),l=c(null),f=c(!1);function y(){f.value=!f.value}return D(async()=>{if(o)try{await a.fetchArticle(o),l.value=a.article,await a.fetchLikers(o),await a.fetchComments(o)}catch(k){console.error("Failed to load article details:",k)}finally{p.value=!1}}),(k,e)=>(g(),w("div",J,[m("div",K,[m("div",{id:"back",onClick:e[0]||(e[0]=t=>u(M).back())},[C(u(z),null,{default:V(()=>[C(u(q))]),_:1})]),e[6]||(e[6]=m("div",null,"内容详情",-1)),e[7]||(e[7]=m("div",{class:"func"},null,-1))]),m("div",P,[l.value?L("",!0):(g(),w("span",Q,"正在加载中...")),l.value?(g(),R(F,{key:1,onClick:e[1]||(e[1]=t=>console.log(l.value)),article:l.value,likers:u(a).likers||[],comments:u(a).comments||[],"is-show-input":!!f.value,"has-more-comments":!1,"remaining-comments":0,"is-loading-comments":!1,onLike:e[2]||(e[2]=()=>u(a).toggleLike(u(o))),onComment:e[3]||(e[3]=()=>y()),onSendReply:e[4]||(e[4]=t=>u(a).createComment(t)),onLoadMoreComments:e[5]||(e[5]=()=>console.warn("点击了load-more-comments, 暂时不支持加载更多"))},null,8,["article","likers","comments","is-show-input"])):L("",!0)])]))}}),ae=E(T,[["__scopeId","data-v-24a24de2"]]);export{ae as default};
