import{d as H,h as T,g as c,x as Z,c as d,b as e,k as h,H as z,e as C,J as g,K as f,l as y,m as N,t as i,Z as j,a2 as J,a3 as K,o as u,A as L,_ as q}from"./index-vHkR6Xec.js";import{d as G}from"./comments-BwFQ22WX.js";const O={class:"top"},Q={for:"comment_id",title:"评论ID"},R={for:"user_id",title:"用户ID"},W={for:"article_id",title:"文章ID"},X={for:"parent_id",title:"父评论ID"},Y={for:"content",title:"评论内容"},ee={class:"list"},te={class:"table-wrapper"},le=["title"],ne=["src"],oe={class:"content-cell"},se={class:"comment-content"},ae={key:0,class:"parent-comment"},ie={key:1,class:"root-comment"},de=["onClick"],ue=["onClick"],re={class:"pagination-wrapper"},ce={class:"pagination-info"},ve={key:0,class:"pagination"},pe=["disabled"],me={key:0,class:"pagination-ellipsis"},ge=["onClick"],fe=["disabled"],be={class:"confirm-header"},_e={class:"confirm-body"},he={class:"confirm-actions"},Ce={class:"modal-body"},Ie={class:"edit-form"},ye={key:0,class:"comment-info"},ke={class:"info-row"},we={class:"info-item"},De={class:"info-item"},Se={class:"info-row"},xe={class:"info-item"},ze={class:"user-info"},Ve=["src"],Me={key:0,class:"info-item"},Ne={class:"form-group full-width"},$e={class:"char-count"},Ue={class:"modal-actions"},Fe=["disabled"],Be=H({__name:"Comment",setup(Ee){const p=T(),V={commentId:"",userId:"",articleId:"",parentId:"",content:""},o=c({...V}),M=c([]),a=c({page:1,pageSize:10,total:0}),$=()=>{o.value={...V},a.value.page=1,m()},m=async()=>{const n={page:a.value.page,pageSize:a.value.pageSize};o.value.commentId&&(n.commentId=Number(o.value.commentId)),o.value.userId&&(n.userId=Number(o.value.userId)),o.value.articleId&&(n.articleId=Number(o.value.articleId)),o.value.parentId&&(n.parentId=Number(o.value.parentId)),o.value.content&&(n.content=o.value.content);try{const t=await J(n);M.value=t.data.data||[],a.value={page:t.data.page||1,pageSize:t.data.pageSize||10,total:t.data.total||0}}catch(t){console.error("获取评论失败:",t),p.show("获取评论失败","error",3e3)}},k=n=>{a.value.page=n,m()},U=n=>{a.value.pageSize=n,a.value.page=1,m()},w=Z(()=>Math.ceil(a.value.total/a.value.pageSize)),r=c(null),D=c(!1),v=c({content:""}),b=c({saving:!1}),F=()=>{const n=a.value.page,t=w.value,l=[];if(t<=7)for(let s=1;s<=t;s++)l.push(s);else if(l.push(1),n<=4){for(let s=2;s<=5;s++)l.push(s);l.push("..."),l.push(t)}else if(n>=t-3){l.push("...");for(let s=t-4;s<=t;s++)s>1&&l.push(s)}else{l.push("...");for(let s=n-1;s<=n+1;s++)l.push(s);l.push("..."),l.push(t)}return l},S=c(!1),_=c({title:"",message:"",onConfirm:()=>{},onCancel:()=>{}}),B=(n,t,l,s)=>{_.value={title:n,message:t,onConfirm:l,onCancel:()=>{}},S.value=!0},x=()=>{S.value=!1},E=async n=>{B("确认删除","确定要删除这条评论吗？此操作不可恢复！",async()=>{const t=p.show("正在删除评论...","loading");try{await G(n),p.update(t,{text:"评论删除成功！",type:"success",duration:2e3}),m(),x()}catch(l){console.error("删除评论失败:",l),p.update(t,{text:"删除失败，请稍后重试",type:"error",duration:3e3})}})},P=n=>{r.value={...n},v.value={content:n.content},D.value=!0},I=()=>{D.value=!1,r.value=null,v.value={content:""},b.value.saving=!1},A=async()=>{if(!r.value||!v.value.content.trim())return;b.value.saving=!0;const n=p.show("正在保存评论...","loading");try{await K(r.value.id,{content:v.value.content.trim()}),p.update(n,{text:"评论更新成功！",type:"success",duration:2e3}),I(),m()}catch(t){console.error("更新评论失败:",t),p.update(n,{text:"更新失败，请稍后重试",type:"error",duration:3e3})}finally{b.value.saving=!1}};return m(),(n,t)=>(u(),d(y,null,[e("div",O,[e("form",{onSubmit:z(m,["prevent"])},[e("label",Q,[t[13]||(t[13]=C("评论ID： ")),g(e("input",{type:"number",id:"comment_id",placeholder:"评论ID","onUpdate:modelValue":t[0]||(t[0]=l=>o.value.commentId=l)},null,512),[[f,o.value.commentId]])]),e("label",R,[t[14]||(t[14]=C("用户ID： ")),g(e("input",{type:"number",id:"user_id",placeholder:"用户ID","onUpdate:modelValue":t[1]||(t[1]=l=>o.value.userId=l)},null,512),[[f,o.value.userId]])]),e("label",W,[t[15]||(t[15]=C("文章ID： ")),g(e("input",{type:"number",id:"article_id",placeholder:"文章ID","onUpdate:modelValue":t[2]||(t[2]=l=>o.value.articleId=l)},null,512),[[f,o.value.articleId]])]),e("label",X,[t[16]||(t[16]=C("父评论ID： ")),g(e("input",{type:"number",id:"parent_id",placeholder:"父评论ID","onUpdate:modelValue":t[3]||(t[3]=l=>o.value.parentId=l)},null,512),[[f,o.value.parentId]])]),e("label",Y,[t[17]||(t[17]=C("评论内容： ")),g(e("input",{type:"text",id:"content",placeholder:"评论内容(支持模糊查询)","onUpdate:modelValue":t[4]||(t[4]=l=>o.value.content=l)},null,512),[[f,o.value.content]])]),t[18]||(t[18]=e("button",{type:"submit"},"查询",-1)),e("button",{type:"button",onClick:$},"重置")],32)]),e("div",ee,[e("div",te,[e("table",null,[t[19]||(t[19]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"用户"),e("th",null,"文章ID"),e("th",null,"评论内容"),e("th",null,"父评论"),e("th",null,"创建时间"),e("th",null,"操作")])],-1)),e("tbody",null,[(u(!0),d(y,null,N(M.value,l=>(u(),d("tr",{key:l.id},[e("td",null,i(l.id),1),e("td",null,[e("div",{class:"user-cell",title:"用户id："+l.user.id},[e("img",{src:l.user.avatar,alt:""},null,8,ne),e("i",null,"@"+i(l.user.username),1)],8,le)]),e("td",null,i(l.article_id),1),e("td",oe,[e("div",se,i(l.content),1)]),e("td",null,[l.parent_id?(u(),d("span",ae," 回复: "+i(l.parent_displayName||`#${l.parent_id}`),1)):(u(),d("span",ie,"主评论"))]),e("td",null,i(l.created_at),1),e("td",null,[e("button",{onClick:s=>P(l),class:"edit-btn"},"编辑",8,de),e("button",{onClick:s=>E(l.id.toString()),class:"delete-btn"},"删除",8,ue)])]))),128))])])])]),e("div",re,[e("div",ce,[e("span",null,"共 "+i(a.value.total)+" 条记录",1),g(e("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.pageSize=l),onChange:t[6]||(t[6]=l=>U(a.value.pageSize)),class:"page-size-select"},t[20]||(t[20]=[e("option",{value:"5"},"5条/页",-1),e("option",{value:"10"},"10条/页",-1),e("option",{value:"20"},"20条/页",-1),e("option",{value:"50"},"50条/页",-1)]),544),[[j,a.value.pageSize]])]),w.value>1?(u(),d("div",ve,[e("button",{disabled:a.value.page<=1,onClick:t[7]||(t[7]=l=>k(a.value.page-1)),class:"pagination-btn"}," 上一页 ",8,pe),(u(!0),d(y,null,N(F(),(l,s)=>(u(),d(y,{key:s},[l==="..."?(u(),d("span",me,"...")):(u(),d("button",{key:1,class:L(["pagination-btn",{active:l===a.value.page}]),onClick:Pe=>k(l)},i(l),11,ge))],64))),128)),e("button",{disabled:a.value.page>=w.value,onClick:t[8]||(t[8]=l=>k(a.value.page+1)),class:"pagination-btn"}," 下一页 ",8,fe)])):h("",!0)]),S.value?(u(),d("div",{key:0,class:"confirm-overlay",onClick:x},[e("div",{class:"confirm-dialog",onClick:t[10]||(t[10]=z(()=>{},["stop"]))},[e("div",be,[e("h3",null,i(_.value.title),1)]),e("div",_e,[t[21]||(t[21]=e("div",{class:"confirm-icon"},[e("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M12 9V14M12 17.5H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z",stroke:"#f59e0b","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1)),e("p",null,i(_.value.message),1)]),e("div",he,[e("button",{type:"button",onClick:x,class:"confirm-cancel-btn"},"取消"),e("button",{type:"button",onClick:t[9]||(t[9]=(...l)=>_.value.onConfirm&&_.value.onConfirm(...l)),class:"confirm-ok-btn"},"确定")])])])):h("",!0),D.value?(u(),d("div",{key:1,class:"modal-overlay",onClick:I},[e("div",{class:"modal-container",onClick:t[12]||(t[12]=z(()=>{},["stop"]))},[e("div",{class:"modal-header"},[t[22]||(t[22]=e("h3",null,"编辑评论",-1)),e("button",{onClick:I,class:"modal-close"},"×")]),e("div",Ce,[e("div",Ie,[r.value?(u(),d("div",ye,[e("div",ke,[e("div",we,[t[23]||(t[23]=e("label",null,"评论ID",-1)),e("span",null,i(r.value.id),1)]),e("div",De,[t[24]||(t[24]=e("label",null,"文章ID",-1)),e("span",null,i(r.value.article_id),1)])]),e("div",Se,[e("div",xe,[t[25]||(t[25]=e("label",null,"评论用户",-1)),e("div",ze,[e("img",{src:r.value.user.avatar,alt:"头像"},null,8,Ve),e("span",null,"@"+i(r.value.user.username),1)])]),r.value.parent_id?(u(),d("div",Me,[t[26]||(t[26]=e("label",null,"回复评论",-1)),e("span",null,i(r.value.parent_displayName||`#${r.value.parent_id}`),1)])):h("",!0)])])):h("",!0),e("div",Ne,[t[27]||(t[27]=e("label",null,"评论内容",-1)),g(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=l=>v.value.content=l),placeholder:"请输入评论内容...",rows:"6",maxlength:"500"},null,512),[[f,v.value.content]]),e("div",$e,i(v.value.content.length)+"/500",1)])])]),e("div",Ue,[e("button",{onClick:I,class:"modal-cancel-btn"},"取消"),e("button",{onClick:A,disabled:b.value.saving||!v.value.content.trim(),class:"modal-save-btn"},i(b.value.saving?"保存中...":"保存"),9,Fe)])])])):h("",!0)],64))}}),Te=q(Be,[["__scopeId","data-v-0ef98adf"]]);export{Te as default};
