import{H as N,B as U}from"./Brief-Dsns6DS1.js";import{f as D}from"./time-Pdvgg59k.js";import{d as x,c as i,b as e,o,t as h,n as a,k as _,p as y,_ as A,u as P,q as T,h as j,s as q,g as f,v as S,x as E,i as F,y as O,a as d,w as m,z as R,A as I,I as b,e as z,l as G,m as J,B as K}from"./index-vHkR6Xec.js";import{c as Q}from"./articles-cyklCtDv.js";import{C as W}from"./ChevronLeft-BvftFjUr.js";import"./UserCircleRegular-DcZmVKiu.js";const X={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Y=x({name:"Cog",render:function(l,v){return o(),i("svg",X,v[0]||(v[0]=[e("path",{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14c-11.1-35.6-30-67.8-54.7-94.6c-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7c-36.7-8.2-74.3-7.8-109.2 0c-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3c-24.7 26.7-43.6 58.9-54.7 94.6c-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14c11.1 35.6 30 67.8 54.7 94.6c3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7c36.7 8.2 74.3 7.8 109.2 0c5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3c24.7-26.7 43.6-58.9 54.7-94.6c1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80s80 35.9 80 80s-35.9 80-80 80z",fill:"currentColor"},null,-1)]))}}),Z={class:"article-item"},ee={class:"time"},te={class:"day"},se={class:"month"},ae={class:"content"},oe={key:0,class:"media"},re={class:"image"},ne=["src"],ie={class:"text"},ce=x({__name:"HomeArticleItem",props:{article:{type:Object,required:!0}},setup(k){const l=k,v=new Date(l.article.created_at).getTime(),u=D(v);return(H,c)=>(o(),i("div",Z,[e("div",ee,[e("div",te,h(a(u).data),1),c[1]||(c[1]=e("div",{class:"divider"},"/",-1)),e("div",se,h(a(u).month)+"月",1)]),e("div",ae,[l.article.article_images&&l.article.article_images.length>0?(o(),i("div",oe,[e("div",re,[e("img",{src:l.article.article_images[0].image_url,alt:"image1"},null,8,ne)])])):_("",!0),e("div",{class:"content-text",onClick:c[0]||(c[0]=g=>a(y).push(`/article/${l.article.id}`))},[e("div",ie,h(k.article.content),1),c[2]||(c[2]=e("div",null,null,-1))])])]))}}),le=A(ce,[["__scopeId","data-v-b4b31ca0"]]),de={class:"container"},ue={class:"top-bar"},me={class:"top-bar-left"},ve={class:"profile"},_e={class:"brief"},ge=["src"],pe={class:"content-container"},fe={class:"content-main"},he={class:"content-footer"},ke={key:0,class:"status-indicator"},ye={key:2,class:"status-indicator"},$e={key:3,class:"status-indicator"},we=x({__name:"Home",setup(k){const l=P(),v=T(),u=j(),c=q().params.username,g=f(1),$=f(""),w=f(""),C=f(""),V=f(""),p=S([]),r=S({total:0,currentPage:1,pageSize:5,isLoading:!1}),B=E(()=>p.length<r.total),L=async n=>{if(r.isLoading)return;r.isLoading=!0;const t=u.show("正在加载文章","loading");try{const s=await Q({page:r.currentPage,pageSize:r.pageSize,userId:n});p.push(...s.data.data),r.total=s.data.total,r.currentPage++,u.update(t,{type:"success",text:"加载成功",duration:2e3})}catch(s){console.error("获取用户文章失败",s),u.update(t,{type:"error",text:"加载失败",duration:2e3})}finally{r.isLoading=!1}};return F(async()=>{try{const n=await O(c);g.value=n.data.id,$.value=n.data.nickname??c,w.value=n.data.avatar??"/img/avatar.jpg",C.value=n.data.header_background??"/img/background.avif",w.value=n.data.avatar,g.value&&await L(g.value),document.title=`${$.value}的主页 - ${v.configs.sitename}`}catch(n){console.error("获取用户文章失败",n),u.show("加载用户文章失败","error",2e3)}}),(n,t)=>(o(),i("div",de,[e("div",ue,[d(N,{headerBackgroundUrl:C.value},{left:m(({isBlurred:s})=>[e("div",me,[d(a(b),{class:I(["icon",{blurred:s}]),onClick:t[0]||(t[0]=M=>a(y).back())},{default:m(()=>[d(a(W))]),_:2},1032,["class"])])]),right:m(({isBlurred:s})=>[e("div",ve,[a(l).token?(o(),R(a(b),{key:0,class:I(["icon",{blurred:s}]),onClick:t[1]||(t[1]=M=>a(y).push({name:"profile"}))},{default:m(()=>[d(a(Y))]),_:2},1032,["class"])):_("",!0)])]),_:1},8,["headerBackgroundUrl"])]),e("div",_e,[d(U,null,{"brief-img":m(()=>[e("span",null,h($.value),1),e("img",{src:w.value,alt:"avatar",onClick:t[2]||(t[2]=s=>a(y).push({name:"profile"}))},null,8,ge)]),"brief-content":m(()=>[z(h(V.value),1)]),_:1})]),e("div",pe,[e("div",fe,[e("ul",null,[(o(!0),i(G,null,J(p,s=>(o(),i("li",{key:s.id},[d(le,{article:s},null,8,["article"])]))),128))])]),e("div",he,[r.isLoading?(o(),i("div",ke,"正在加载中...")):_("",!0),B.value&&!r.isLoading?(o(),i("div",{key:1,onClick:t[3]||(t[3]=s=>L(g.value)),class:"status-indicator"},[t[4]||(t[4]=z(" 加载更多 ")),d(a(b),null,{default:m(()=>[d(a(K))]),_:1})])):_("",!0),!B.value&&p.length>0?(o(),i("div",ye,"- 没有更多了 -")):_("",!0),p.length===0?(o(),i("div",$e,"- 该用户还没有发表内容哦 -")):_("",!0)])])]))}}),Ie=A(we,[["__scopeId","data-v-5a85263b"]]);export{Ie as default};
